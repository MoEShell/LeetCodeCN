# 29. 两数相除

### 思考

首先想到的是除法相当于多次减法，所以考虑转化成减法，然后果不其然超时了。所以就想到了另一种解法：位运算。

以 109/3 为例：

十进制相除可以分解为：

1. 3扩大10倍，109 先和 30 相除，商 3 余 19,此时3对应十位数
2. 3扩大1倍（也就是不扩大），余数再和3除，商6余1,此时6对应个位数
3. 最终结果为30+6,即36

对应二进制数相除，先将除数左移（扩大）到合适大小，再逐步右移（缩小）。商每次要左移一位，并对应补 1 或 0.由于是二进制，只有 1 和 0，所以除法可以看作减法计算。

109：1101101, 3：11

| 步数 | 被除数    | 除数      | 余数（差） | 商      |
| ---- | --------- | --------- | ---------- | ------- |
| 1    | 0110,1101 | 0110,0000 | 0000,1101  | 1       |
| 2    | 0000,1101 | 0011,0000 | 0000,1101  | 10      |
| 3    | 0000,1101 | 0001,1000 | 0000,1101  | 100     |
| 4    | 0000,1101 | 0000,1100 | 0000,0001  | 1001    |
| 5    | 0000,0001 | 0000,0110 | 0000,0001  | 1,0010  |
| 6    | 0000,0001 | 0000,0011 | 0000,0001  | 10,0100 |

所以商为36(0010,0100)，余数为1(0000,0001)

需要注意的是：

1. 除数左移右移过程中，右移到原始大小要再计算一次，然后计算结束。
2. 注意负数和溢出。这里取巧，记录结果正负后转化为 long 型再取绝对值。计算出结果后再计算正负/溢出。（Java 中 long 一定比 int 长，C里只规定 long 不短于 int，所以对 C 语言可以用 unsigned int）
3. 因为取巧转为正数，所以右移必须是无符号右移（>>>）

算法：

1. 标记商正负，被除数和除数转为long型非负数
2. 将除数左移，直到比被除数大为止，并记录左移步数
3. 商左移一位
4. 将除数右移，比较被除数与除数大小。
   1. 若被除数大于等于除数，商补1，被除数减去除数
   2. 若被除数小于除数，不处理
5. 除数右移一位，步数减一
6. 重复2～4步，直到步数小于0为止
7. 处理溢出
   1. 若商大于 2<sup>32</sup> 一定溢出
   2. 若商等于 2<sup>32</sup> 且为正，溢出
8. 转为int型并计算正负

### 知识点

位运算更高效